<?xml version="1.0"?>
<ruleset name="Nepada Coding Standard">
    <arg name="extensions" value="php,phpt"/>

    <config name="installed_paths" value="../../consistence/coding-standard"/><!-- relative path from PHPCS source location -->

    <rule ref="Consistence">
        <exclude name="Consistence.Exceptions.ExceptionDeclaration.IncorrectExceptionDirectory"/><!-- we place exceptions into a single exceptions.php file -->
        <exclude name="Generic.CodeAnalysis.EmptyStatement.DetectedCatch"/><!-- empty catch statements are allowed -->
        <exclude name="Generic.Commenting.Todo"/><!-- allow TODO comments -->
        <exclude name="Generic.WhiteSpace.DisallowSpaceIndent"/><!-- we use spaces instead of tabs -->
        <exclude name="PSR2.Namespaces.NamespaceDeclaration.BlankLineAfter"/><!-- too strict, we use 2 lines to separate namespace/use AND class/function -->
        <exclude name="PSR2.Namespaces.UseDeclaration.SpaceAfterLastUse"/><!-- too strict, we use 2 lines to separate namespace/use AND class/function -->
        <exclude name="SlevomatCodingStandard.Namespaces.FullyQualifiedClassNameAfterKeyword"/><!-- we don't use FQN -->
        <exclude name="SlevomatCodingStandard.Namespaces.FullyQualifiedClassNameInAnnotation"/><!-- we don't use FQN -->
        <exclude name="SlevomatCodingStandard.Namespaces.FullyQualifiedExceptions"/><!-- we don't use FQN -->
        <exclude name="SlevomatCodingStandard.Namespaces.UnusedUses.MismatchingCaseSensitivity"/><!-- see slevomat/coding-standard#278 -->
        <exclude name="Squiz.Strings.DoubleQuoteUsage.ContainsVar"/><!-- we do not strictly require sprintf -->
        <exclude name="Squiz.WhiteSpace.FunctionSpacing"/><!-- we use 2 blank lines to separate attributes and methods - replaced by our sniff -->
    </rule>

    <rule ref="Generic.CodeAnalysis.JumbledIncrementer"/>
    <rule ref="Generic.CodeAnalysis.UselessOverridingMethod"/>
    <rule ref="Generic.Formatting.MultipleStatementAlignment">
        <properties>
            <property name="maxPadding" value="0"/>
            <property name="error" value="true"/>
        </properties>
    </rule>
    <rule ref="Generic.WhiteSpace.DisallowTabIndent"/>
    <rule ref="Generic.WhiteSpace.ScopeIndent">
        <properties>
            <property name="tabIndent" value="false"/>
        </properties>
    </rule>
    <rule ref="SlevomatCodingStandard.ControlStructures.AssignmentInCondition"/>
    <rule ref="SlevomatCodingStandard.ControlStructures.LanguageConstructWithParentheses"/>
    <rule ref="SlevomatCodingStandard.ControlStructures.NewWithParentheses"/>
    <rule ref="SlevomatCodingStandard.ControlStructures.RequireNullCoalesceOperator"/>
    <rule ref="SlevomatCodingStandard.Namespaces.ReferenceUsedNamesOnly">
        <properties>
            <property name="allowFullyQualifiedExceptions" value="false"/>
            <property name="allowFullyQualifiedGlobalClasses" value="true"/>
            <property name="allowPartialUses" value="true"/>
            <property name="fullyQualifiedKeywords" type="array" value=""/>
        </properties>
    </rule>
    <rule ref="SlevomatCodingStandard.Namespaces.UnusedUses">
        <properties>
            <property name="searchAnnotations" value="true"/>
        </properties>
    </rule>
    <rule ref="SlevomatCodingStandard.TypeHints.DeclareStrictTypes">
        <properties>
            <property name="newlinesCountBetweenOpenTagAndDeclare" value="1"/>
        </properties>
    </rule>
    <rule ref="SlevomatCodingStandard.TypeHints.TypeHintDeclaration">
        <exclude name="SlevomatCodingStandard.TypeHints.TypeHintDeclaration.UselessParameterAnnotation"/><!-- keep all PHPdoc blocks -->
        <exclude name="SlevomatCodingStandard.TypeHints.TypeHintDeclaration.UselessReturnAnnotation"/><!-- keep all PHPdoc blocks -->
        <exclude name="SlevomatCodingStandard.TypeHints.TypeHintDeclaration.UselessDocComment"/><!-- keep all PHPdoc blocks -->
    </rule>

    <!-- allow grouping of exception in one file -->
    <rule ref="PSR1.Classes.ClassDeclaration.MultipleClasses">
        <exclude-pattern>*/exceptions.php</exclude-pattern>
    </rule>
    <rule ref="Squiz.Classes.ClassFileName.NoMatch">
        <exclude-pattern>*/exceptions.php</exclude-pattern>
    </rule>

    <!-- special settings for tests and bootstrap -->
    <exclude-pattern>*/tests/temp/*</exclude-pattern>
    <rule ref="PSR1.Files.SideEffects">
        <exclude-pattern>*.phpt</exclude-pattern>
        <exclude-pattern>*/bootstrap.php</exclude-pattern>
    </rule>
    <rule ref="Squiz.Functions.GlobalFunction">
        <exclude-pattern>*.phpt</exclude-pattern>
        <exclude-pattern>*/tests/bootstrap.php</exclude-pattern>
    </rule>
</ruleset>
